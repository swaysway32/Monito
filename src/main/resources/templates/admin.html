<!DOCTYPE html>
<html lang="en" data-theme="light" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Monito</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #6c757d;
            --text-muted: #adb5bd;
            --accent-primary: #3498db;
            --accent-secondary: #e74c3c;
            --accent-success: #27ae60;
            --accent-warning: #f39c12;
            --border-color: #dee2e6;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-card: #3a3a3a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #888888;
            --accent-primary: #4a9eff;
            --accent-secondary: #ff6b6b;
            --accent-success: #51cf66;
            --accent-warning: #ffd43b;
            --border-color: #4a4a4a;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body { font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg-primary); color: var(--text-primary); line-height: 1.6; transition: all 0.3s ease; }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        header { background-color: var(--bg-card); box-shadow: var(--shadow); position: sticky; top: 0; z-index: 100; }
        nav { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; }
        .logo { font-size: 2rem; font-weight: bold; color: var(--accent-primary); text-decoration: none; }
        .nav-links { display: flex; list-style: none; gap: 2rem; align-items: center; }
        .nav-links a { text-decoration: none; color: var(--text-primary); font-weight: 500; transition: color 0.3s ease; }
        .nav-links a:hover { color: var(--accent-primary); }
        .admin-badge { background-color: var(--accent-secondary); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; }

        .theme-toggle { position: relative; display: inline-block; width: 60px; height: 30px; }
        .theme-toggle input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--border-color); transition: 0.4s; border-radius: 30px; }
        .slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 4px; bottom: 4px; background-color: white; transition: 0.4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent-primary); }
        input:checked + .slider:before { transform: translateX(30px); }

        .admin-header { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); color: white; text-align: center; padding: 3rem 0; }
        .admin-header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .admin-header p { font-size: 1.1rem; opacity: 0.9; }

        .stats-section { padding: 3rem 0; background-color: var(--bg-secondary); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background-color: var(--bg-card); padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow); text-align: center; transition: transform 0.3s ease; border: 1px solid var(--border-color); }
        .stat-card:hover { transform: translateY(-2px); }
        .stat-icon { width: 50px; height: 50px; border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; }
        .stat-icon.total { background-color: var(--accent-primary); }
        .stat-number { font-size: 2rem; font-weight: bold; color: var(--text-primary); }
        .stat-label { color: var(--text-secondary); font-size: 0.9rem; }

        .applications-section { padding: 3rem 0; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .section-title { font-size: 2rem; color: var(--text-primary); }

        .application-card { background-color: var(--bg-card); border-radius: 12px; padding: 1.5rem; box-shadow: var(--shadow); border: 1px solid var(--border-color); transition: all 0.3s ease; }
        .application-card:hover { box-shadow: var(--shadow-hover); }

        .btn { display: inline-block; padding: 10px 20px; border: none; border-radius: 8px; text-decoration: none; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-align: center; font-size: 0.9rem; }
        .btn-danger { background-color: var(--accent-secondary); color: white; }
        .btn-danger:hover { background-color: #c0392b; transform: translateY(-1px); }
        .btn-view { background-color: var(--accent-primary); color: white; }
        .btn-view:hover { background-color: #2980b9; transform: translateY(-1px); }
        .btn-secondary { background-color: var(--bg-secondary); color: var(--text-primary); border: 2px solid var(--border-color); }
        .btn-secondary:hover { background-color: var(--border-color); }

        .alert { padding: 1rem; border-radius: 8px; margin: 1rem auto; max-width: 1200px; text-align: center; }
        .alert-success { background-color: var(--accent-success); color: white; }
        .alert-error { background-color: var(--accent-secondary); color: white; }

        footer { background-color: var(--bg-card); padding: 3rem 0 1rem; margin-top: 4rem; border-top: 1px solid var(--border-color); }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 2rem; }
        .footer-section h3 { margin-bottom: 1rem; color: var(--accent-primary); }
        .footer-section ul { list-style: none; }
        .footer-section ul li { margin-bottom: 0.5rem; }
        .footer-section ul li a { color: var(--text-secondary); text-decoration: none; transition: color 0.3s ease; }
        .footer-section ul li a:hover { color: var(--accent-primary); }
        .social-icons { display: flex; gap: 1rem; margin-top: 1rem; }
        .social-icon { width: 40px; height: 40px; background-color: var(--accent-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; text-decoration: none; transition: transform 0.3s ease; }
        .social-icon:hover { transform: scale(1.1); }
        .footer-bottom { text-align: center; padding-top: 2rem; border-top: 1px solid var(--border-color); color: var(--text-muted); }

        .mobile-menu-toggle { display: none; background: none; border: none; font-size: 1.5rem; color: var(--text-primary); cursor: pointer; }

        @media (max-width: 768px) {
            .nav-links { display: none; }
            .mobile-menu-toggle { display: block; }
            .admin-header h1 { font-size: 2rem; }
            .section-header { flex-direction: column; gap: 1rem; align-items: flex-start; }
            .container { padding: 0 15px; }
        }

        .hidden { display: none; }
    </style>
    <script>
        function confirmDeleteAll() {
            return confirm('Are you sure you want to delete ALL products? This cannot be undone.');
        }
    </script>
    </head>
<body>
    <header>
        <nav class="container">
            <a th:href="@{/}" class="logo">Monito</a>
            <ul class="nav-links">
                <li><a th:href="@{/}">Home</a></li>
                <li th:if="${isAdmin}"><span class="admin-badge">Admin</span></li>
                <li th:if="${isLoggedIn}"><a th:href="@{/logout}">Logout</a></li>
                <li th:if="${!isLoggedIn}"><a th:href="@{/login}">Login</a></li>
                <li>
                    <label class="theme-toggle">
                        <input type="checkbox" id="theme-switch">
                        <span class="slider"></span>
                    </label>
                </li>
            </ul>
            <button class="mobile-menu-toggle">‚ò∞</button>
        </nav>
    </header>

    <main>
        <div th:if="${message}" class="alert alert-success">
            <span th:text="${message}"></span>
        </div>
        <div th:if="${error}" class="alert alert-error">
            <span th:text="${error}"></span>
        </div>

        <section class="admin-header">
            <div class="container">
                <h1>Admin Dashboard</h1>
                <p>Manage products and platform operations</p>
            </div>
        </section>

        <section class="stats-section">
            <div class="container">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon total">üì¶</div>
                        <div class="stat-number" th:text="${totalListings}">0</div>
                        <div class="stat-label">Total Products</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background-color: var(--accent-warning);">üë•</div>
                        <div class="stat-number" th:text="${totalApplications}">0</div>
                        <div class="stat-label">Total Applications</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background-color: var(--accent-secondary);">‚è≥</div>
                        <div class="stat-number" th:text="${pendingCount}">0</div>
                        <div class="stat-label">Pending Reviews</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="applications-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Product Management</h2>
                    <form th:action="@{/admin/listings/delete-all}" method="post" onsubmit="return confirmDeleteAll()">
                        <button type="submit" class="btn btn-danger">Delete All Products</button>
                    </form>
                </div>

                <div class="application-card" th:if="${#lists.isEmpty(listings)}">
                    <div style="text-align: center; padding: 2rem;">
                        <h3>No Products Found</h3>
                        <p>There are currently no products to display.</p>
                    </div>
                </div>

                <div class="application-card" th:each="item : ${listings}">
                    <div style="display:flex; justify-content: space-between; align-items:center; gap:1rem;">
                        <div>
                            <h3 th:text="${item.name}">Product Name</h3>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                <span th:text="${item.category}">Category</span>
                                <span th:if="${item.price != null}" th:text="${' ‚Ä¢ NPR ' + #numbers.formatDecimal(item.price, 1, 'COMMA', 2, 'POINT')}"></span>
                            </div>
                            <p style="margin-top:0.5rem; color: var(--text-secondary);" th:text="${item.description}">Description</p>
                        </div>
                        <div style="display:flex; gap: .5rem;">
                            <a class="btn btn-view" th:if="${item.contact}" th:text="${'Contact: ' + item.contact}" href="#">Contact</a>
                            <form th:action="@{/admin/listings/{id}/delete(id=${item.id})}" method="post" onsubmit="return confirm('Delete this product? This cannot be undone.');">
                                <button type="submit" class="btn btn-danger">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seller Application Management Section -->
        <section class="applications-section" style="background-color: var(--bg-secondary);">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Seller Applications</h2>
                    <div style="display: flex; gap: 1rem;">
                        <button onclick="toggleApplications('pending')" class="btn btn-secondary" id="pendingBtn">Pending (<span th:text="${pendingCount}">0</span>)</button>
                        <button onclick="toggleApplications('all')" class="btn btn-secondary" id="allBtn">All Applications</button>
                    </div>
                </div>

                <!-- Pending Applications -->
                <div id="pendingApplications">
                    <div class="application-card" th:if="${#lists.isEmpty(pendingApplications)}">
                        <div style="text-align: center; padding: 2rem;">
                            <h3>No Pending Applications</h3>
                            <p>All seller applications have been reviewed.</p>
                        </div>
                    </div>

                    <div class="application-card" th:each="app : ${pendingApplications}">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem; flex-wrap: wrap;">
                            <div style="flex: 1; min-width: 300px;">
                                <h3 th:text="${app.firstName + ' ' + app.lastName}">Applicant Name</h3>
                                <div style="color: var(--text-secondary); font-size: 0.9rem; margin: 0.5rem 0;">
                                    <div><strong>Email:</strong> <span th:text="${app.email}">email@example.com</span></div>
                                    <div><strong>Phone:</strong> <span th:text="${app.phone}">+1234567890</span></div>
                                    <div><strong>Business:</strong> <span th:text="${app.businessName}">Business Name</span></div>
                                    <div><strong>Type:</strong> <span th:text="${app.businessType}">Business Type</span></div>
                                    <div><strong>Location:</strong> <span th:text="${app.location}">City, State</span></div>
                                    <div><strong>Experience:</strong> <span th:text="${app.experience}">Experience Level</span></div>
                                </div>
                                <div style="margin: 1rem 0;">
                                    <strong>Business Description:</strong>
                                    <p style="margin-top: 0.5rem; color: var(--text-secondary);" th:text="${app.businessDescription}">Business description...</p>
                                </div>
                                <div style="margin: 1rem 0;">
                                    <strong>Reason to Sell:</strong>
                                    <p style="margin-top: 0.5rem; color: var(--text-secondary);" th:text="${app.reasonToSell}">Reason to sell...</p>
                                </div>
                                <div style="color: var(--text-muted); font-size: 0.8rem;">
                                    Applied: <span th:text="${#temporals.format(app.applicationDate, 'MMM dd, yyyy HH:mm')}">Date</span>
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem; min-width: 200px;">
                                <form th:action="@{/admin/seller-applications/{id}/approve(id=${app.id})}" method="post" style="margin: 0;">
                                    <textarea name="adminNotes" placeholder="Admin notes (optional)" style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; resize: vertical; min-height: 60px;"></textarea>
                                    <button type="submit" class="btn" style="background-color: var(--accent-success); color: white; width: 100%;">Approve</button>
                                </form>
                                <form th:action="@{/admin/seller-applications/{id}/reject(id=${app.id})}" method="post" style="margin: 0;">
                                    <textarea name="adminNotes" placeholder="Rejection reason (optional)" style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; resize: vertical; min-height: 60px;"></textarea>
                                    <button type="submit" class="btn btn-danger" style="width: 100%;">Reject</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- All Applications -->
                <div id="allApplications" class="hidden">
                    <div class="application-card" th:if="${#lists.isEmpty(allApplications)}">
                        <div style="text-align: center; padding: 2rem;">
                            <h3>No Applications Found</h3>
                            <p>No seller applications have been submitted yet.</p>
                        </div>
                    </div>

                    <div class="application-card" th:each="app : ${allApplications}">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem; flex-wrap: wrap;">
                            <div style="flex: 1; min-width: 300px;">
                                <h3 th:text="${app.firstName + ' ' + app.lastName}">Applicant Name</h3>
                                <div style="color: var(--text-secondary); font-size: 0.9rem; margin: 0.5rem 0;">
                                    <div><strong>Email:</strong> <span th:text="${app.email}">email@example.com</span></div>
                                    <div><strong>Phone:</strong> <span th:text="${app.phone}">+1234567890</span></div>
                                    <div><strong>Business:</strong> <span th:text="${app.businessName}">Business Name</span></div>
                                    <div><strong>Type:</strong> <span th:text="${app.businessType}">Business Type</span></div>
                                    <div><strong>Location:</strong> <span th:text="${app.location}">City, State</span></div>
                                    <div><strong>Experience:</strong> <span th:text="${app.experience}">Experience Level</span></div>
                                    <div><strong>Status:</strong> 
                                        <span th:if="${app.status == 'pending'}" style="color: var(--accent-warning); font-weight: bold;">PENDING</span>
                                        <span th:if="${app.status == 'approved'}" style="color: var(--accent-success); font-weight: bold;">APPROVED</span>
                                        <span th:if="${app.status == 'rejected'}" style="color: var(--accent-secondary); font-weight: bold;">REJECTED</span>
                                    </div>
                                </div>
                                <div style="margin: 1rem 0;">
                                    <strong>Business Description:</strong>
                                    <p style="margin-top: 0.5rem; color: var(--text-secondary);" th:text="${app.businessDescription}">Business description...</p>
                                </div>
                                <div style="margin: 1rem 0;">
                                    <strong>Reason to Sell:</strong>
                                    <p style="margin-top: 0.5rem; color: var(--text-secondary);" th:text="${app.reasonToSell}">Reason to sell...</p>
                                </div>
                                <div th:if="${app.adminNotes}" style="margin: 1rem 0;">
                                    <strong>Admin Notes:</strong>
                                    <p style="margin-top: 0.5rem; color: var(--text-secondary);" th:text="${app.adminNotes}">Admin notes...</p>
                                </div>
                                <div style="color: var(--text-muted); font-size: 0.8rem;">
                                    Applied: <span th:text="${#temporals.format(app.applicationDate, 'MMM dd, yyyy HH:mm')}">Date</span>
                                    <span th:if="${app.reviewDate}"> | Reviewed: <span th:text="${#temporals.format(app.reviewDate, 'MMM dd, yyyy HH:mm')}">Date</span></span>
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem; min-width: 200px;" th:if="${app.status == 'pending'}">
                                <form th:action="@{/admin/seller-applications/{id}/approve(id=${app.id})}" method="post" style="margin: 0;">
                                    <textarea name="adminNotes" placeholder="Admin notes (optional)" style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; resize: vertical; min-height: 60px;"></textarea>
                                    <button type="submit" class="btn" style="background-color: var(--accent-success); color: white; width: 100%;">Approve</button>
                                </form>
                                <form th:action="@{/admin/seller-applications/{id}/reject(id=${app.id})}" method="post" style="margin: 0;">
                                    <textarea name="adminNotes" placeholder="Rejection reason (optional)" style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; resize: vertical; min-height: 60px;"></textarea>
                                    <button type="submit" class="btn btn-danger" style="width: 100%;">Reject</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a th:href="@{/}">Home</a></li>
                        <li><a href="#">Browse Pets</a></li>
                        <li><a href="#">Browse Pet Toys</a></li>
                        <li><a href="#">Become a Seller</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Safety Guidelines</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Connect With Us</h3>
                    <div class="social-icons">
                        <a href="#" class="social-icon">f</a>
                        <a href="#" class="social-icon">t</a>
                        <a href="#" class="social-icon">i</a>
                        <a href="#" class="social-icon">y</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Monito Pet Marketplace. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        const themeSwitch = document.getElementById('theme-switch');
        const htmlElement = document.documentElement;
        if (themeSwitch) {
            themeSwitch.addEventListener('change', function() {
                if (this.checked) {
                    htmlElement.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    htmlElement.setAttribute('data-theme', 'light');
                    localStorage.setItem('theme', 'light');
                }
            });
        }
        const savedTheme = localStorage.getItem('theme') || 'light';
        htmlElement.setAttribute('data-theme', savedTheme);
        if (savedTheme === 'dark' && themeSwitch) {
            themeSwitch.checked = true;
        }

        function toggleApplications(type) {
            const pendingDiv = document.getElementById('pendingApplications');
            const allDiv = document.getElementById('allApplications');
            const pendingBtn = document.getElementById('pendingBtn');
            const allBtn = document.getElementById('allBtn');

            if (type === 'pending') {
                pendingDiv.classList.remove('hidden');
                allDiv.classList.add('hidden');
                pendingBtn.style.backgroundColor = 'var(--accent-primary)';
                pendingBtn.style.color = 'white';
                allBtn.style.backgroundColor = 'var(--bg-secondary)';
                allBtn.style.color = 'var(--text-primary)';
            } else {
                pendingDiv.classList.add('hidden');
                allDiv.classList.remove('hidden');
                allBtn.style.backgroundColor = 'var(--accent-primary)';
                allBtn.style.color = 'white';
                pendingBtn.style.backgroundColor = 'var(--bg-secondary)';
                pendingBtn.style.color = 'var(--text-primary)';
            }
        }

        // Initialize with pending applications shown
        document.addEventListener('DOMContentLoaded', function() {
            toggleApplications('pending');
        });
    </script>
</body>
</html>